---
title: 'iEEG: Localization of intracranial electrodes'
author: Fei
date: '2020-12-22'
slug: ieeg-localization-of-intracranial-electrodes
categories:
  - reading
tags:
  - data
weight: 1
draft: yes
output:
  blogdown::html_page:
    toc: yes
    toc_depth: 3
    number_sections: yes
---

```{r include=FALSE}
knitr::opts_chunk$set(warning = F, message = F, cache = TRUE,tidy=F,fig.align='center',fig.showtext=TRUE,results="hold",fig.show = "hold")
```

# Introduction
This is a simple tutorial for electrodes localization. For more information and examples, please refer to [Fieldtrip tutorials](https://www.fieldtriptoolbox.org/tutorial/human_ecog/). Matlab, [SPM](https://www.fil.ion.ucl.ac.uk/spm/software/download/), and [Fieldtrip](https://www.fieldtriptoolbox.org/download.php) are requied for this procedure. After adding the root directory to searching path, you need to initialize Filedtrip toolbox by running the command `ft_defaults` as well. It is convenient to add this command to startup.m, so that it will be executed automatically when starting Matlab.

# Overview

# Preprocessing of MRI image

# Preprocessing of CT image

<img src="/post/2020-12-22-ieeg-localization-of-intracranial-electrodes_files/spm.png" style="width: 50%; display: block; margin:0 auto"/>
<!-- ![](/post/2020-12-22-ieeg-localization-of-intracranial-electrodes_files/spm.png) -->

<img src="/post/2020-12-22-ieeg-localization-of-intracranial-electrodes_files/display_after.png" style="width: 90%; display: block; margin:0 auto"/>
<!-- ![](/post/2020-12-22-ieeg-localization-of-intracranial-electrodes_files/display_after.png) -->

# Fusion of the CT with the MRI

# Electrodes placement
Detect the weighted peak (`cfg.magtype = peakweighted`) around 3 (`cfg.magradius = 3`) pixels.
# Volume-based registration
[Pediatric atlases](http://nist.mni.mcgill.ca/?p=974)

# Anatomical labeling

``` matlab
% load coordinates
load([filepath '/' subjID '_elec_mni_fv.mat']);
[ftver, ftpath] = ft_version;
% use brainnetome atlas
atlas = ft_read_atlas([ftpath filesep 'template/atlas/brainnetome/BNA_MPM_thr25_1.25mm.nii']);
cfg            = [];
cfg.roi        = elec_mni_fv.chanpos(:,:);
cfg.atlas      = atlas;
cfg.output     = 'multiple';
labels = ft_volumelookup(cfg, atlas);

% save labels to the cell "position"
len=length(labels);
position=cell(len,1);
for i=1:len
    [~, indx] = max(labels(i).count);
    position{i}=labels(i).name(indx);
end
```
Brainnetome atlas seems more accurate than AAL atlas.