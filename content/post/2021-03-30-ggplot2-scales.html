---
title: 'ggplot2: Scales'
author: Fei
date: '2021-03-30'
slug: ggplot2-scales
categories:
  - R
tags:
  - plot
  - R
weight: 1
draft: yes
output:
  blogdown::html_page:
    toc: yes
    toc_depth: 3
    number_sections: yes
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#position-scales-and-axes"><span class="toc-section-number">2</span> Position scales and axes</a>
<ul>
<li><a href="#numeric"><span class="toc-section-number">2.1</span> Numeric</a></li>
<li><a href="#date-time"><span class="toc-section-number">2.2</span> Date-time</a></li>
<li><a href="#discrete"><span class="toc-section-number">2.3</span> Discrete</a></li>
<li><a href="#binned"><span class="toc-section-number">2.4</span> Binned</a></li>
<li><a href="#limits"><span class="toc-section-number">2.5</span> Limits</a></li>
</ul></li>
<li><a href="#color-scales-and-legends"><span class="toc-section-number">3</span> Color scales and legends</a>
<ul>
<li><a href="#continuous-color-scales"><span class="toc-section-number">3.1</span> Continuous color scales</a></li>
<li><a href="#discrete-colour-scales"><span class="toc-section-number">3.2</span> Discrete colour scales</a></li>
</ul></li>
</ul>
</div>

<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>The scales toolbox divide scales into three main groups:</p>
<ul>
<li>Position scales and axes.</li>
<li>Color scales and legends.</li>
<li>Scales for other aesthetics.</li>
</ul>
</div>
<div id="position-scales-and-axes" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Position scales and axes</h1>
<p>Sometimes an aesthetic is mapped to a <strong>computed variable</strong> that does not need to be explicitly specified, as happens with <code>geom_histogram()</code>, which use the computed variable <code>count</code>.</p>
<div id="numeric" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Numeric</h2>
<p>The most common continuous position scales are the default <code>scale_x_continuous()</code> and <code>scale_y_continuous()</code>. Other functions like <code>scale_x_log10()</code>, <code>scale_x_reverse()</code> transform the data, which can also be achieved by setting the <code>trans</code> option.</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Function <span class="math inline">\(f(x)\)</span></th>
<th>Name</th>
<th>Function <span class="math inline">\(f(x)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>asn</td>
<td><span class="math inline">\(\tanh^{-1}(x)\)</span></td>
<td>logit</td>
<td><span class="math inline">\(\log(\frac{x}{1 - x})\)</span></td>
</tr>
<tr class="even">
<td>exp</td>
<td><span class="math inline">\(e ^ x\)</span></td>
<td>pow10</td>
<td><span class="math inline">\(10^x\)</span></td>
</tr>
<tr class="odd">
<td>identity</td>
<td><span class="math inline">\(x\)</span></td>
<td>probit</td>
<td><span class="math inline">\(\Phi(x)\)</span></td>
</tr>
<tr class="even">
<td>log</td>
<td><span class="math inline">\(\log(x)\)</span></td>
<td>reciprocal</td>
<td><span class="math inline">\(x^{-1}\)</span></td>
</tr>
<tr class="odd">
<td>log10</td>
<td><span class="math inline">\(\log_{10}(x)\)</span></td>
<td>reverse</td>
<td><span class="math inline">\(-x\)</span></td>
</tr>
<tr class="even">
<td>log2</td>
<td><span class="math inline">\(\log_2(x)\)</span></td>
<td>sqrt</td>
<td><span class="math inline">\(x^{1/2}\)</span></td>
</tr>
</tbody>
</table>
<p>Specifically, if you use a transformed scale, the axes will be labeled in the original data space; if you transform the data, the axes will be labeled in the transformed space. To transform after statistical computation use <code>coord_trans()</code>.</p>
<pre class="r"><code># manual transformation
ggplot(mpg, aes(log10(displ), hwy)) + 
  geom_point() |

# transform using scales
ggplot(mpg, aes(displ, hwy)) + 
  geom_point() + 
  scale_x_log10()</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>By default, ggplot2 converts data outside the scale limits to <code>NA</code>, because the default value of <code>oob</code> (out of boundary) argument is <code>scales::censor()</code>. Setting it to <code>scales::squish()</code> will squishes all values into the range.</p>
<p>The space around the plot can be eliminated with <code>expand = c(0, 0)</code>. To make sure some values are shown on the plots, use <code>expand_limits()</code>.</p>
<pre class="r"><code>ggplot(faithfuld, aes(waiting, eruptions)) + 
  geom_raster(aes(fill = density)) + 
  theme(legend.position = &quot;none&quot;) +
  expand_limits(x=1,y=1)|

ggplot(faithfuld, aes(waiting, eruptions)) + 
  geom_raster(aes(fill = density)) + 
  scale_x_continuous(expand = c(0,0),trans = &quot;reverse&quot;) + 
  scale_y_continuous(expand = c(0,0)) +
  theme(legend.position = &quot;none&quot;)|
  
ggplot(faithfuld, aes(waiting, eruptions)) + 
  geom_raster(aes(fill = density)) +
  # multiply 5
  scale_x_continuous(expand = c(5,0)) + 
  # add 5 at each side
  scale_y_continuous(expand = c(0,5)) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Breaks can be added manually, but ggplot2 also allows you to pass a function to <code>breaks</code>:</p>
<ul>
<li><code>scales::breaks_extended()</code> creates automatic breaks for numeric axes (the standard method).</li>
<li><code>scales::breaks_log()</code> creates breaks appropriate for log axes.</li>
<li><code>scales::breaks_pretty()</code> creates “pretty” breaks for date/times.</li>
<li><code>scales::breaks_width()</code> creates equally spaced</li>
</ul>
<p>Every break is associated with a label and these can be changed by setting the <code>labels</code> argument to the scale function:</p>
<ul>
<li><code>scales::label_bytes()</code> formats numbers as kilobytes, megabytes etc.</li>
<li><code>scales::label_comma()</code> formats numbers as decimals with commas added.</li>
<li><code>scales::label_dollar()</code> formats numbers as currency.</li>
<li><code>scales::label_ordinal()</code> formats numbers in rank order: 1st, 2nd, 3rd etc.</li>
<li><code>scales::label_percent()</code> formats numbers as percentages.</li>
<li><code>scales::label_pvalue()</code> formats numbers as p-values: &lt;.05, &lt;.01, .34, etc.</li>
</ul>
<p>As with breaks, you can also supply a function to minor_breaks, such as <code>scales::minor_breaks_n()</code> or <code>scales::minor_breaks_width()</code> functions that can be helpful in controlling the minor breaks. However, these minor breaks do not add ticks on the axis.</p>
<pre class="r"><code>toy &lt;- data.frame(
  const = 1,   up = 1:4,  txt = letters[1:4], 
  big = (1:4)*1000,  log = c(2, 5, 10, 2000))
# add breaks without labels
brks = seq(500, 4000, 250)
lbs &lt;- ifelse(brks%%1000 == 0, brks, &quot;&quot;)
# plot
axs &lt;- ggplot(toy, aes(big, const)) + geom_point() + labs(x = NULL, y = NULL)
# minor breaks
axs + scale_x_continuous(breaks = scales::breaks_extended(n = 4),
                         minor_breaks = seq(1500,4000,250))|
# use offset to control breaks
axs + scale_x_continuous(breaks = scales::breaks_width(800, offset = 200))|
# control labels
axs + scale_y_continuous(labels = scales::label_dollar(prefix = &quot;￥&quot;, suffix = &quot;€&quot;))|
# breaks without labels
axs + scale_x_continuous(breaks = brks, labels = lbs)</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;" /></p>
</div>
<div id="date-time" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Date-time</h2>
<p>Different formats of date/time can be converted by a few functions (<code>as.Date()</code>, <code>as.POSIXct()</code> or <code>hms::as_hms()</code>) or the <strong>lubridate</strong> package. Default scale for dates is <code>scale_x_date()</code> and <code>scale_x_datetime()</code> is default for data-time data.</p>
<p>Breaks and minor breaks can be specified by <code>date_breaks</code> and <code>data_minor_breaks</code> respectively. Date label formatting is useful when there’s no sufficient room.</p>
<pre class="r"><code>date_base &lt;- ggplot(economics, aes(date, psavert)) + 
  geom_line(na.rm = TRUE) +
  labs(x = NULL, y = NULL)

date_base + scale_x_date(date_breaks = &quot;25 years&quot;,
                         date_minor_breaks = &quot;5 years&quot;,
                         date_labels = &quot;%y&quot;) |
# formatting with function label_date, or label_date_short
date_base + scale_x_date(labels = scales::label_date(&quot;%Y&quot;))</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="discrete" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Discrete</h2>
<p>The default scales mapping discrete variables to position scales are <code>scale_x_discrete()</code> and <code>scale_y_discrete()</code>. Internally, ggplot2 handles discrete scales by mapping each category to an integer value and then drawing the geom at the corresponding coordinate location. Labels of the discrete variable can be set by <code>labels</code> and <code>guide_axis()</code> controls their layout.</p>
<pre class="r"><code>base &lt;- ggplot(mpg, aes(manufacturer, hwy)) + geom_boxplot()

base + guides(x = guide_axis(n.dodge = 3)) |
# as.character() is not needed for numbers
base + scale_x_discrete(labels = 1:length(unique(mpg$manufacturer)))+
       guides(x = guide_axis(angle = 90))</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="binned" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Binned</h2>
<p>Continuous variables can be sliced into multiple bins (e.g. <code>geom_count</code>).</p>
<pre class="r"><code>base &lt;- ggplot(mpg, aes(hwy, class)) + geom_count()

base |
base + scale_x_binned(n.breaks = 10)</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
<div id="limits" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Limits</h2>
<p>To make sure different plots share the same axes and legend, just like faceted plots, multiple limits (x, y, color, etc.) should be set.</p>
<pre class="r"><code>mpg_99 &lt;- mpg %&gt;% filter(year == 1999)
mpg_08 &lt;- mpg %&gt;% filter(year == 2008)

base_99 &lt;- ggplot(mpg_99, aes(displ, hwy, colour = fl)) + geom_point() 
base_08 &lt;- ggplot(mpg_08, aes(displ, hwy, colour = fl)) + geom_point()

base_99 +
  scale_x_continuous(limits = c(1, 7)) +
  scale_y_continuous(limits = c(10, 45)) +
  scale_color_discrete(limits = c(&quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;p&quot;, &quot;r&quot;))|
base_08 + 
  # lims() is another option
  lims(x = c(1, 7), y = c(10, 45), color = c(&quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;p&quot;, &quot;r&quot;))</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="color-scales-and-legends" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Color scales and legends</h1>
<div id="continuous-color-scales" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Continuous color scales</h2>
<p>There are multiple ways to specify continuous color scales. There are many palettes available, but the common interface is <strong>paletteer</strong> package.</p>
<pre class="r"><code>erupt &lt;- ggplot(faithfuld, aes(waiting, eruptions, fill = density)) +
  geom_raster() +
  scale_x_continuous(NULL, expand = c(0, 0)) + 
  scale_y_continuous(NULL, expand = c(0, 0)) + 
  theme(legend.position = &quot;none&quot;,
        axis.text = element_blank(),
        axis.ticks = element_blank(),
        axis.line=element_blank(),)

plots &lt;- list(erupt,
              erupt + scale_fill_viridis_c(option = &quot;magma&quot;),
              erupt + scale_fill_distiller(palette = &quot;RdPu&quot;),
              erupt + scico::scale_fill_scico(palette = &quot;lajolla&quot;),
              erupt + scale_fill_fermenter(),
              erupt + paletteer::scale_fill_paletteer_c(&quot;viridis::plasma&quot;))
wrap_plots(plots,ncol = 3)</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-10-1.png" width="441.6" style="display: block; margin: auto;" /></p>
<p>The default scale for continuous fill scales is <code>scale_fill_continuous()</code> which in turn defaults to <code>scale_fill_gradient()</code>. Gradient scales provide a robust method for creating any color scheme you like:</p>
<ul>
<li><code>scale_fill_gradient()</code> produces a two-colour gradient</li>
<li><code>scale_fill_gradient2()</code> produces a three-colour gradient with specified midpoint</li>
<li><code>scale_fill_gradientn()</code> produces an n-colour gradient</li>
</ul>
<p>Other packages, such as <a href="https://github.com/cwickham/munsell/"><strong>munsell</strong></a> and <a href="https://colorspace.r-forge.r-project.org/"><strong>colorspace</strong></a> also provide color palettes.</p>
<pre class="r"><code># munsell example
erupt + scale_fill_gradient(
  low = munsell::mnsl(&quot;5P 2/12&quot;), 
  high = munsell::mnsl(&quot;5P 7/12&quot;)
) |
# colorspace examples
erupt + scale_fill_gradientn(colours = colorspace::heat_hcl(7))|
erupt + scale_fill_gradientn(colours = colorspace::diverge_hcl(7))</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-11-1.png" width="441.6" style="display: block; margin: auto;" /></p>
<p>Missing values are set to grey by default, which can be changed by set <code>na.value</code> option. Breaks can be entirely suppressed by setting them to <code>NULL</code>.</p>
<pre class="r"><code>df &lt;- data.frame(x = 1, y = 1:5, z = c(1, 3, 2, NA, 5))
base &lt;- ggplot(df, aes(x, y)) + 
  geom_tile(aes(fill = z), size = 5) + 
  labs(x = NULL, y = NULL)

base |
base + scale_fill_gradient(na.value = NA)|
base + scale_fill_gradient(na.value = &quot;yellow&quot;,
                           breaks = NULL)+
        scale_x_continuous(breaks = NULL)</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-12-1.png" width="441.6" style="display: block; margin: auto;" /></p>
</div>
<div id="discrete-colour-scales" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Discrete colour scales</h2>
<p>The default scale for discrete colors is <code>scale_fill_discrete()</code> which in turn defaults to <code>scale_fill_hue()</code>, and <code>scale_colour_brewer()</code> is a discrete color scale that—along with the continuous analog <code>scale_colour_distiller()</code> and binned analog <code>scale_colour_fermenter()</code> using handpicked <a href="http://colorbrewer2.org/">“ColorBrewer”</a> colors.</p>
</div>
</div>
