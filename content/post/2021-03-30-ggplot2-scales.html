---
title: 'ggplot2: Scales'
author: Fei
date: '2021-03-30'
slug: ggplot2-scales
categories:
  - R
tags:
  - plot
  - R
weight: 1
draft: yes
output:
  blogdown::html_page:
    toc: yes
    toc_depth: 3
    number_sections: yes
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#position-scales-and-axes"><span class="toc-section-number">2</span> Position scales and axes</a>
<ul>
<li><a href="#numeric"><span class="toc-section-number">2.1</span> Numeric</a></li>
</ul></li>
</ul>
</div>

<div id="introduction" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>The scales toolbox divide scales into three main groups:</p>
<ul>
<li>Position scales and axes.</li>
<li>Color scales and legends.</li>
<li>Scales for other aesthetics.</li>
</ul>
</div>
<div id="position-scales-and-axes" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Position scales and axes</h1>
<p>Sometimes an aesthetic is mapped to a <strong>computed variable</strong> that does not need to be explicitly specified, as happens with <code>geom_histogram()</code>, which use the computed variable <code>count</code>.</p>
<div id="numeric" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Numeric</h2>
<p>The most common continuous position scales are the default <code>scale_x_continuous()</code> and <code>scale_y_continuous()</code>. Other functions like <code>scale_x_log10()</code>, <code>scale_x_reverse()</code> transform the data, which can also be achieved by setting the <code>trans</code> option.</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th>Function <span class="math inline">\(f(x)\)</span></th>
<th>Name</th>
<th>Function <span class="math inline">\(f(x)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>asn</td>
<td><span class="math inline">\(\tanh^{-1}(x)\)</span></td>
<td>logit</td>
<td><span class="math inline">\(\log(\frac{x}{1 - x})\)</span></td>
</tr>
<tr class="even">
<td>exp</td>
<td><span class="math inline">\(e ^ x\)</span></td>
<td>pow10</td>
<td><span class="math inline">\(10^x\)</span></td>
</tr>
<tr class="odd">
<td>identity</td>
<td><span class="math inline">\(x\)</span></td>
<td>probit</td>
<td><span class="math inline">\(\Phi(x)\)</span></td>
</tr>
<tr class="even">
<td>log</td>
<td><span class="math inline">\(\log(x)\)</span></td>
<td>reciprocal</td>
<td><span class="math inline">\(x^{-1}\)</span></td>
</tr>
<tr class="odd">
<td>log10</td>
<td><span class="math inline">\(\log_{10}(x)\)</span></td>
<td>reverse</td>
<td><span class="math inline">\(-x\)</span></td>
</tr>
<tr class="even">
<td>log2</td>
<td><span class="math inline">\(\log_2(x)\)</span></td>
<td>sqrt</td>
<td><span class="math inline">\(x^{1/2}\)</span></td>
</tr>
</tbody>
</table>
<p>Specifically, if you use a transformed scale, the axes will be labeled in the original data space; if you transform the data, the axes will be labelled in the transformed space.</p>
<pre class="r"><code># manual transformation
ggplot(mpg, aes(log10(displ), hwy)) + 
  geom_point() |

# transform using scales
ggplot(mpg, aes(displ, hwy)) + 
  geom_point() + 
  scale_x_log10()</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;" /></p>
<p>By default, ggplot2 converts data outside the scale limits to <code>NA</code>, because the default value of <code>oob</code> (out of boundary) argument is <code>scales::censor()</code>. Setting it to <code>scales::squish()</code> will squishes all values into the range.</p>
<p>The space around the plot can be eliminated with <code>expand = c(0, 0)</code>. To make sure some values are shown on the plots, use <code>expand_limits()</code>.</p>
<pre class="r"><code>ggplot(faithfuld, aes(waiting, eruptions)) + 
  geom_raster(aes(fill = density)) + 
  theme(legend.position = &quot;none&quot;) +
  expand_limits(x=1,y=1)|

ggplot(faithfuld, aes(waiting, eruptions)) + 
  geom_raster(aes(fill = density)) + 
  scale_x_continuous(expand = c(0,0),trans = &quot;reverse&quot;) + 
  scale_y_continuous(expand = c(0,0)) +
  theme(legend.position = &quot;none&quot;)|
  
ggplot(faithfuld, aes(waiting, eruptions)) + 
  geom_raster(aes(fill = density)) +
  # multiply 5
  scale_x_continuous(expand = c(5,0)) + 
  # add 5 at each side
  scale_y_continuous(expand = c(0,5)) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Breaks can be added manually, but ggplot2 also allows you to pass a function to <code>breaks</code>:</p>
<ul>
<li><code>scales::breaks_extended()</code> creates automatic breaks for numeric axes (the standard method).</li>
<li><code>scales::breaks_log()</code> creates breaks appropriate for log axes.</li>
<li><code>scales::breaks_pretty()</code> creates “pretty” breaks for date/times.</li>
<li><code>scales::breaks_width()</code> creates equally spaced</li>
</ul>
<p>Every break is associated with a label and these can be changed by setting the <code>labels</code> argument to the scale function:</p>
<ul>
<li><code>scales::label_bytes()</code> formats numbers as kilobytes, megabytes etc.</li>
<li><code>scales::label_comma()</code> formats numbers as decimals with commas added.</li>
<li><code>scales::label_dollar()</code> formats numbers as currency.</li>
<li><code>scales::label_ordinal()</code> formats numbers in rank order: 1st, 2nd, 3rd etc.</li>
<li><code>scales::label_percent()</code> formats numbers as percentages.</li>
<li><code>scales::label_pvalue()</code> formats numbers as p-values: &lt;.05, &lt;.01, .34, etc.</li>
</ul>
<p>As with breaks, you can also supply a function to minor_breaks, such as <code>scales::minor_breaks_n()</code> or <code>scales::minor_breaks_width()</code> functions that can be helpful in controlling the minor breaks. However, these minor breaks do not add ticks on the axis.</p>
<pre class="r"><code>toy &lt;- data.frame(
  const = 1,   up = 1:4,  txt = letters[1:4], 
  big = (1:4)*1000,  log = c(2, 5, 10, 2000))
# add breaks without labels
brks = seq(500, 4000, 250)
lbs &lt;- ifelse(brks%%1000 == 0, brks, &quot;&quot;)
# plot
axs &lt;- ggplot(toy, aes(big, const)) + geom_point() + labs(x = NULL, y = NULL)
# minor breaks
axs + scale_x_continuous(breaks = scales::breaks_extended(n = 4),
                         minor_breaks = seq(1500,4000,250))|
# use offset to control breaks
axs + scale_x_continuous(breaks = scales::breaks_width(800, offset = 200))|
# control labels
axs + scale_y_continuous(labels = scales::label_dollar(prefix = &quot;￥&quot;, suffix = &quot;€&quot;))|
# breaks without labels
axs + scale_x_continuous(breaks = brks, labels = lbs)</code></pre>
<p><img src="/post/2021-03-30-ggplot2-scales_files/figure-html/unnamed-chunk-5-1.png" width="864" style="display: block; margin: auto;" /></p>
</div>
</div>
